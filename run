#!/bin/sh

function delete_user() {
    MONGO_URI="mongodb://localhost:27017"
    DB_NAME="purplecoinsv2"
    COLLECTION_NAME="users"
    USER_NAME="Test User"

    mongosh "$MONGO_URI/$DB_NAME" --eval "
        db.getCollection('$COLLECTION_NAME').deleteOne({ name: '$USER_NAME' });
        print('Deleted document with name: \"$USER_NAME\"');
    "
}

if [ "$1" = "test" ]; then
    cd test
    maestro test automation.yaml
    delete_user
elif [ "$1" = "frontend" ]; then
    cd frontend && yarn dev
elif [ "$1" = "backend" ]; then
    cd backend && yarn dev
elif [ "$1" = "format" ]; then
    cd backend && yarn format
    cd -
    cd frontend && yarn format
    cd -
else
    echo "Usage:"
    echo "./run test - To run E2E tests"
    echo "./run frontend - To run frontend"
    echo "./run backend - To run backend"
    echo "./run format - To format code"
    exit 1
fi